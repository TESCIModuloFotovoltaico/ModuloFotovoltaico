<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Módulo Fotovoltaico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="stilos/styles.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="wrapper" transition-style="in:custom:circle-swoop">

        <div class="position-relative">
            <div class="bg-success text-white py-4 text-center">
                <h1 class="m-0">Módulo Fotovoltaico</h1>
            </div>

            <div class="logo-sobrepuesto text-center">
                <img src="recursos/logo.png" alt="Logo" class="logo-grande-sobrepuesto img-fluid" />
            </div>

            <nav class="navbar navbar-expand-lg navbar-light bg-warning">
                <div class="container-fluid">
                    <a class="navbar-brand d-flex align-items-center" href="https://tesci.edomex.gob.mx">
                        <img src="recursos/rino.png" alt="" style="height: 40px;" class="me-2" />
                        TESCI
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item"><a class="nav-link active" href="index.html">Inicio</a></li>
                            <li class="nav-item"><a class="nav-link" href="tabla.html">Estadísticas</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <div class="container my-5 text-center">
            <button id="btnConsultar" class="btn btn-primary">Consultar datos</button>
        </div>

        <div class="container">
            <canvas id="miGrafica"></canvas>
        </div>

    </div> <footer class="text-center py-3">
        <p>Derechos Reservados</p>
    </footer>

    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
        import Chart from 'https://esm.sh/chart.js@4';

        const supabaseUrl = "https://cmnkmgdybqcpipgsposc.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtbmttZ2R5YnFjcGlwZ3Nwb3NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4Nzg1MjcsImV4cCI6MjA3MTQ1NDUyN30.n-bJ4vtGg_9IA1jSFDWPRQq4fLLdhmok53_C2DRxJiA";
        const supabase = createClient(supabaseUrl, supabaseKey);

        document.getElementById("btnConsultar").addEventListener("click", async () => {
            try {
                const { data, error } = await supabase
                    .from("Baterias")
                    .select("Fecha, Voltaje (V)");

                if (error) throw error;

                console.log("Datos recibidos:", data);

                // Extraer los datos de la base de datos para la gráfica
                const fechas = data.map(row => row.Fecha);
                const voltajes = data.map(row => row["Voltaje (V)"]);

                // Configurar y dibujar la gráfica
                const ctx = document.getElementById('miGrafica').getContext('2d');
                new Chart(ctx, {
                    type: 'line', // Tipo de gráfica: línea
                    data: {
                        labels: fechas,
                        datasets: [{
                            label: 'Voltaje (V)',
                            data: voltajes,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true // Para crear la gráfica de área tipo pico
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            } catch (err) {
                console.error("Error en la consulta:", err.message);
            }
        });
    </script>

</body>
</html>
